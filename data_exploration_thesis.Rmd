---
title: "Thesis"
output: html_document
date: "2024-05-08"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load the data:
```{r}
data <- load("RData (2)")
```

Contains 5 files:
genera-lists the different expression values for different genera groups of each sample. 220 samples and 11721 different genes.
metadata- contains information about patients. 220 samples- datset, sample name,
subject name, study group, age, faecal calprotectin, antibiotics, immunosupressant,
mesalamine and steroids. 
mtb- gives abundance values of each metabolite for each sample. 220 samples, 8849 met. 
mtb.map- contains information on all the metabolites such as name, KEGG code, mz, retention time. 
species- the same as genera but by species instead. 220 samples,  55883 species. 

# Look for missing data:
```{r}
sum(is.na(genera)) #0
sum(is.na(species)) #0
sum(is.na(metadata)) #140
sum(is.na(mtb)) #0
sum(is.na(mtb.map)) #45090
```

Missing data only on the names of some of the metabolites as they are unknown. 
Missing data on some of the patient data:
```{r}
sum(is.na(metadata$Fecal.Calprotectin)) # 67
sum(is.na(metadata$antibiotic)) #3
sum(is.na(metadata$immunosuppressant)) #22
sum(is.na(metadata$mesalamine)) #24
sum(is.na(metadata$steroids)) #24
```
# Data Sparsity:

There is lots of sparisty in the data as some samples contain none of certain genera or species:
```{r}
sum(genera == 0)
sum(species == 0)
```
# PCA Visualisation:
```{r}
library(tidyverse)
#make samples the columns:
genera_t <- t(genera)
#make column names sample names and remove that row:
colnames(genera_t) <- genera_t[1, ]
genera_t <- genera_t[-1, ]
#make df with numbers only:
genera_t <- as.data.frame(genera_t)
genera_t[] <- lapply(genera_t, as.numeric)

#Create PCA:
pca_x  <- t(genera_t)
pca_res1 <- prcomp(pca_x, scale = TRUE, center = TRUE)
pca_df1 <- data.frame(
  pca_res1$x,
  Disease = metadata$Study.Group,
  sample = genera$Sample)

ggplot(pca_df1, aes(x = PC1, y = PC2, color = Disease)) + 
  geom_point(size = 3) + 
  theme_bw() +  
  labs(x = "PC1", y = "PC2") +  
  theme(legend.position = "bottom")
```

